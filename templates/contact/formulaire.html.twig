{% extends '@theme/partials/_master.twig' %}
{% import "@crm-core/macros/form_type.html.twig" as fields %}
{% import "@crm-core/macros/open_street_map.twig" as OSM %}

{% block stylesheets %}
    {{ parent() }}
    <!-- Bootstrap Font Icon CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{{ asset('crm-assets/css/bootstrap.min.css') }}"/>
{% endblock %}

{% block main %}
    <style>
        textarea {
            max-width: 100%;
        }

        .map-section {
            padding-bottom: 5em;
        }

        .errors-form {
            padding: 1em;
        }

        .errors-form .error-line {
            color: red;
        }

        .w-20p {
            width: 20%;
            float: left;
        }

        .w-50p {
            width: 50%;
            float: left;
        }

        .w-80p {
            width: 80%;
            float: left;
        }

        .h-8 {
            height: 2rem
        }

        .h-12 {
            height: 3rem
        }

        .no-float {
            float: none;
        }

        .lmt-8 {
            top: 2rem;
            position: relative;
        }
    </style>
    {% include '@crm-contact/includes/_map_css.twig' %}

    <section class="mt-16 w-full mx-4 px-4 mb-4">
        <div class="container px-5 py-8 mx-auto bg-gray-100">
            <span class="text-2xl font-semibold px-2">Formulaire de constact</span>
            <div class="px-2">
                {% if coordonnees.visu %}
                    <div class="w-50p h-auto">
                        <div class="w-full">
                            <div class="w-full mb-2 px-2">
                                <span class="text-lg">Nous contacter</span>
                                <p class="text-xs">Vous pouvre nous contacter en remplissant le formulaire si contre ou
                                    par l'un des
                                    moyens suivant.</p>
                            </div>
                            <div class="w-full mb-2 px-2">
                                <span class="text-lg">Nous appeler</h3>
                                    <p class="text-xs">{{ coordonnees.tel }}</p>
                            </div>
                            <div class="w-full mb-2 px-2">
                                <span class="text-lg">Nous écrire</span>
                                <p class="text-xs"><a href="mailto:{{ coordonnees.courriel }}" class="__cf_email__"
                                                      data-cfemail="8ce5e2eae3cce1ede5e0a2efe3e1">{{ coordonnees.courriel }}</a>
                                </p>
                            </div>
                            <div class="w-full mb-2 px-2">
                                <h3 class="text-lg">Notre Adresse</h3>
                                <p class="text-xs">{{ adresse.adresse }}</p>
                                {% if adresse.complement is not empty %}
                                    <p class="text-xs">{{ adresse.complement }}</p>
                                {% endif %}
                                <p class="text-xs">{{ adresse['code-post'] }} {{ adresse.ville }}</p>
                            </div>
                        </div>
                    </div>
                {% endif %}
                <div class="{% if coordonnees.visu %}wp-50p lmt-8{% else %}mt-1{% endif %}">
                    <div class="w-full">
                        <span class="w-full text-xl">Faite votre demande ici</span>
                        {{ form_start(form, {'class': 'w-full'}) }}
                        {{ form_row(form._token) }}
                        {% set errors = form.vars.errors.form.getErrors(true) %}
                        {% if errors|length %}
                            <ul class="errors-form w-full">
                                {% for error in errors %}
                                    <li class="error-line w-full">{{ error.message }}</li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                        <div class="w-full mt-2 h-6">
                            {{ fields.field(form.nom, "Nom", {
                                'class': 'w-50p mb-2', 'placeholder': 'Votre nom*',
                                'il_class': {'label': 'w-50p px-2', 'input': 'w-50p'},
                            }) }}
                            {{ fields.field(form.prenom, 'Prénom', {
                                'class': 'w-50p mb-2', 'placeholder': 'Votre prénom',
                                'il_class': {'label': 'w-50p px-2', 'input': 'w-50p'}
                            }) }}
                        </div>
                        <div class="w-full mt-2 h-6">
                            {{ fields.field(form.adrCourriel, '@mail', {
                                'class': 'w-50p mb-2',
                                'placeholder': "Votre Adresses courriel (@mail)*",
                                'il_class': {'label': 'w-50p px-2', 'input': 'w-50p'}
                            }) }}
                            {{ fields.field(form.telephone, 'Tél.', {
                                'class': 'w-50p mb-2', 'placeholder': 'Votre téléphone',
                                'il_class': {'label': 'w-50p px-2', 'input': 'w-50p'}
                            }) }}
                        </div>
                    </div>
                    <div class="w-full mt-2 no-float">
                        <div class="w-full mt-2 h-auto">
                            {{ fields.field(form.sujet, '', {
                                'class': 'mb-2',
                                'placeholder': "L'objet de votre demande*",
                                'il_class': {'label': '', 'input': ''}
                            }) }}
                            {% set classTextArea = coordonnees.visu ? 'w-50p' : '' %}
                            {{ fields.textarea(form.demande, '', {
                                'class': classTextArea, 'cols': "72", 'rows': "5",
                                'placeholder': " Saisissez votre demande*",
                            }) }}
                        </div>
                        <div class="w-full mt-2 text-center">
                            {{ fields.checkbox(form.contactMe, 'Je souhaite que vous me contactiez', {
                                'class': '', 'inline': true, 'cl_class': {'check': 'ms-0 me-2' }
                            }) }}
                        </div>
                        <div class="w-full mt-2">
                            {{ fields.submitbtn(form.submit, "", {
                                'class': 'w-full text-white gradient text-center',
                            }) }}
                        </div>
                        {{ form_end(form, {render_rest: false}) }}
                    </div>
                    <div class="w-full mt-2 text-right text-gray-600">
                        * champs obligatoires
                    </div>
                </div>
            </div>
        </div>
    </section>

    {% if OSM_params.visu %}
        <div class="mt-16 w-full mx-4 px-4 mb-4 map-section">
            <div class="container px-5 py-8 mx-auto bg-gray-100">
                <div class="w-full">
                    <div class="w-full">
                        <div class="mapouter">
                            <div class="gmap_canvas">
                                {{ OSM.map(OSM_params.container, {
                                    'height': OSM_params.height,
                                    'lat': OSM_params.lat, 'long': OSM_params.long,
                                    'zoom': OSM_params.zoom,
                                    'zoomMax': OSM_params.zoomMax, 'zoomMin': OSM_params.zoomMin,
                                    'libellM': config.get('general/sitename'),
                                }) }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('crm-assets/js/bootstrap.min.js') }}"></script>
    <script src="{{ asset('crm-assets/js/tom-select.complete.js') }}"></script>
{% endblock %}
